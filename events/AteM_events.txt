add_namespace = atem
country_event = { ##1## Dorwinion Great Merchants send wine gift
	id = atem.1
	title = atem.1.t
	desc = atem.1.d
	picture = GFX_offer_wine
	
	is_triggered_only = yes
	option = { ##Accept
		name = atem.1.a
		ai_chance = {
			factor = 1.5
			modifier = {
				has_government = FROM
				factor = 2
			}
			modifier = {
				has_opinion = {
					target = FROM
					value > 25
				}
				factor = 2
			}
		}
		accept_dorwinion_wine_effect = yes
		hidden_effect = { FROM = { news_event = { id = rfr_news.82 hours = 1 } } }
	}
	option = { ##Reject
		name = atem.1.b
		ai_chance = {
			factor = 1
			modifier = { #we don't wanna be friendly with dorwinion
				OR = {
					has_government = conquest
					has_government = melkorite
				}
				factor = 10
			}
			modifier = {
				has_opinion = {
					target = FROM
					value < -25
				}
				factor = 2
			}
			modifier = { #don't spend unessessarily
				has_equipment = {
					wine_equipment > 2000
				}
				factor = 2
			}
		}
		hidden_effect = { FROM = { news_event = { id = rfr_news.83 hours = 1 } } }
	}
}

country_event = { ##2## Dorwinion askes elves for wisdom
	id = atem.2
	title = atem.2.t
	desc = atem.2.d
	picture = GFX_offer_wine
	
	is_triggered_only = yes
	option = { ##Accept
		name = atem.2.a
		ai_chance = {
			factor = 2
			modifier = {
				has_government = FROM
				factor = 2
			}
			modifier = {
				has_opinion = {
					target = FROM
					value > 25
				}
				factor = 2
			}
		}
		DOR_seek_wisdom_of_elves_effect = yes
		hidden_effect = { FROM = { news_event = { id = rfr_news.85 hours = 1 } } }
	}
	option = { ##Reject
		name = atem.2.b
		ai_chance = {
			factor = 1
			modifier = { #we don't wanna be friendly with dorwinion
				OR = {
					has_government = conquest
					has_government = melkorite
				}
				factor = 10
			}
			modifier = {
				has_opinion = {
					target = FROM
					value < -25
				}
				factor = 2
			}
			modifier = { #don't spend unessessarily
				has_equipment = {
					wine_equipment > 2000
				}
				factor = 1.5
			}
		}
		hidden_effect = { FROM = { news_event = { id = rfr_news.86 hours = 1 } } }
	}
}

country_event = { ##3## Dorwinion trade delegation
	id = atem.3
	title = atem.3.t
	desc = atem.3.d
	picture = GFX_offer_wine
	
	is_triggered_only = yes
	option = { ##Accept
		name = atem.3.a
		ai_chance = {
			factor = 2
			modifier = {
				has_government = FROM
				factor = 2
			}
			modifier = {
				has_opinion = {
					target = FROM
					value > 25
				}
				factor = 2
			}
		}
		DOR_seek_wisdom_of_elves_effect = yes
		hidden_effect = { FROM = { news_event = { id = rfr_news.93 hours = 1 } } }
	}
	option = { ##Reject
		name = atem.3.b
		ai_chance = {
			factor = 1
			modifier = { #we don't wanna be friendly with dorwinion
				OR = {
					has_government = conquest
					has_government = melkorite
				}
				factor = 10
			}
			modifier = {
				has_opinion = {
					target = FROM
					value < -25
				}
				factor = 2
			}
			modifier = { #don't spend unessessarily
				has_equipment = {
					wine_equipment > 2000
				}
				factor = 1.5
			}
		}
		hidden_effect = { FROM = { news_event = { id = rfr_news.94 hours = 1 } } }
	}
}

country_event = { ##4## Dorwinion requests investment
	id = atem.4
	title = atem.4.t
	desc = atem.4.d
	picture = GFX_feast
	
	is_triggered_only = yes
	option = { ##large investment
		name = atem.4.a
		trigger = { num_of_civilian_factories_available_for_projects > 0 }
		ai_chance = {
			factor = 2
			modifier = {
				has_government = FROM
				factor = 2
			}
			modifier = {
				has_opinion = {
					target = FROM
					value > 25
				}
				factor = 2
			}
		}
		invest_fully_in_DOR_effect = yes
		hidden_effect = { FROM = { news_event = { id = rfr_news.87 hours = 1 } } }
	}
	option = { ##small investment
		name = atem.4.b
		ai_chance = {
			factor = 1
			modifier = { #we don't wanna be friendly with dorwinion
				OR = {
					has_government = conquest
					has_government = melkorite
				}
				factor = 10
			}
			modifier = {
				has_opinion = {
					target = FROM
					value < -25
				}
				factor = 2
			}
			modifier = { #don't spend unessessarily
				has_equipment = {
					wine_equipment > 2000
				}
				factor = 1.5
			}
		}
		invest_partially_in_DOR_effect = yes
		hidden_effect = { FROM = { news_event = { id = rfr_news.88 hours = 1 } } }
	}
	
	option = { ##reject
		name = atem.4.c
		ai_chance = {
			factor = 1
			modifier = { #we don't wanna be friendly with dorwinion
				OR = {
					has_government = conquest
					has_government = melkorite
				}
				factor = 10
			}
			modifier = {
				has_opinion = {
					target = FROM
					value < -25
				}
				factor = 2
			}
			modifier = { #don't spend unessessarily
				has_equipment = {
					wine_equipment > 2000
				}
				factor = 1.5
			}
		}
		hidden_effect = { FROM = { news_event = { id = rfr_news.89 hours = 1 } } }
	}
}

country_event = { ##5## Dorwinion wants to reestablish merchant offices
	id = atem.5
	title = atem.5.t
	desc = atem.5.d
	picture = GFX_offer_wine
	
	is_triggered_only = yes
	option = { ##Accept
		name = atem.5.a
		ai_chance = {
			factor = 2
			modifier = {
				is_subject_of = FROM
				factor = 200
			}
			modifier = {
				has_government = FROM
				factor = 2
			}
			modifier = {
				has_opinion = {
					target = FROM
					value > 25
				}
				factor = 2
			}
		}
		reestablish_merchant_offices_effect = yes
		hidden_effect = { FROM = { news_event = { id = rfr_news.91 hours = 1 } } }
	}
	option = { ##Reject
		name = atem.5.b
		ai_chance = {
			factor = 1
			modifier = { #we don't wanna be friendly with dorwinion
				OR = {
					has_government = conquest
					has_government = melkorite
				}
				factor = 10
			}
			modifier = {
				has_opinion = {
					target = FROM
					value < -25
				}
				factor = 2
			}
		}
		refuse_merchant_offices_effect = yes
		hidden_effect = { FROM = { news_event = { id = rfr_news.92 hours = 1 } } }
	}
}

country_event = { ##6## Hawin Koldana Falls ill
	id = atem.6
	title = atem.6.t
	desc = atem.6.d
	picture = GFX_theodred_wounded
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			DOR_hawin_koldana = {
				add_country_leader_trait = {
					ideology = elective_monarchy_isolationism
					trait = deathly_ill
				}
				add_country_leader_trait = {
					ideology = elective_monarchy_opportunism
					trait = deathly_ill
				}
			}
			country_event = { id = atem.7 days = 14 } #the event that actually kills him
		}
	}
	
	option = { ##Oh no
		name = atem.6.a
		ai_chance = {
			factor = 1
		}
		custom_effect_tooltip = has_happened_tooltip
		effect_tooltip = {
			DOR_hawin_koldana = {
				add_country_leader_trait = {
					ideology = elective_monarchy_isolationism
					trait = deathly_ill
				}
			}
		}
	}
}

country_event = { ##7## Hawin Koldana Dies, election happens
	id = atem.7
	title = {
		text = atem.t.d.a
		trigger = {
			DOR = {
				has_country_leader = {
					character = DOR_bergholda_aldiana
					ruling_only = yes
				}
			}
		}
	}
	title = {
		text = atem.7.t.b
	}
	desc = {
		text = atem.7.d.a
		trigger = {
			DOR = {
				has_country_leader = {
					character = DOR_bergholda_aldiana
					ruling_only = yes
				}
			}
		}
	}
	desc = {
		text = atem.7.d.b
	}
	picture = GFX_aragorn_coronation_event
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			retire_character = DOR_hawin_koldana
			promote_character = {
				character = DOR_bergholda_aldiana
				ideology = elective_monarchy_isolationism
			}
			promote_character = {
				character = DOR_bladorthin_koldana
				ideology = elective_monarchy_opportunism
			}
			if = {
				limit = {
					is_power_balance_side_active = {
						id = DOR_election_power_balance
						side = DOR_winelords_side
					}
				}
				DOR_bladorthin_koldana = {
					if = { ##in case you leveled him up, upgrade his ruler trait
						limit = { has_trait = army_chief_organizational_2 }
						swap_country_leader_traits = {
							remove = army_chief_organizational_1
							add = army_chief_organizational_2
							ideology = elective_monarchy_opportunism
						}
					}
					else_if = { ##in case you leveled him up, upgrade his ruler trait
						limit = { has_trait = army_chief_organizational_3 }
						swap_country_leader_traits = {
							remove = army_chief_organizational_1
							add = army_chief_organizational_3
							ideology = elective_monarchy_opportunism
						}
					}
					remove_advisor_role = {
					  slot = political_advisor
					}
					remove_advisor_role = {
					  slot = army_chief
					}
				}
				set_politics = {
					ruling_party = opportunism
				}
				add_popularity = {
					ideology = opportunism
					popularity = 0.1
				}
				if = { #reward PP
					limit = { has_country_flag = supporting_winelords }
					add_political_power = 100
				}
				set_country_flag = elected_winelord
				remove_power_balance = {
					id = DOR_election_power_balance
				}

				set_power_balance = {
					id = DOR_winelords_power_balance
					left_side = DOR_koldana_side
					right_side = DOR_vierling_side
					set_default = yes
				}
				if = { ##BoP from focuses
					limit = { has_completed_focus = DOR_rally_support_for_bladorthin }
					add_power_balance_value = {
						id = DOR_winelords_power_balance
						value = -0.1
					}
				}
				else_if = {
					limit = { has_completed_focus = DOR_rally_support_for_vidumarh }
					add_power_balance_value = {
						id = DOR_winelords_power_balance
						value = 0.1
					}
				}
				#figure out how much BoP from advisors
				DOR_winelords_BOP_initial_advisors = yes
			}
			else = {
				DOR_bergholda_aldiana = {
					remove_advisor_role = {
					  slot = political_advisor
					}
					remove_advisor_role = {
					  slot = theorist
					}
				}
				add_popularity = {
					ideology = isolationism
					popularity = 0.1
				}
				if = { #reward PP
					limit = { has_country_flag = supporting_great_merchants }
					add_political_power = 100
				}
				set_country_flag = elected_great_merchant
				remove_power_balance = {
					id = DOR_election_power_balance
				}
				set_power_balance = {
					id = DOR_great_merchants_power_balance
					left_side = DOR_burghers_side
					right_side = DOR_merchant_houses_side
					set_default = yes
				}
				#figure out how much BoP from advisors
				set_temp_variable = { advisor_bop = merchant_house_advisors }
				subtract_from_temp_variable = { advisor_bop = burgher_advisors }
				multiply_temp_variable = { advisor_bop = 0.05 }
				meta_effect = {
					text = {
						add_power_balance_value = {
							id = DOR_great_merchants_power_balance
							value = BOP
						}
					}
					BOP = "[?advisor_bop]"
				}
			}
			news_event = { id = rfr_news.98 hours = 1 } #tell everyone else
		}
	}
	
	option = { ##Long live the realm master
		name = atem.7.a
		ai_chance = {
			factor = 1
		}
		custom_effect_tooltip = has_happened_tooltip
		effect_tooltip = {
			custom_effect_tooltip = hawin_koldana_dies
			if = {
				limit = { has_government = opportunism }
				custom_effect_tooltip = bladorthin_koldana_ascends
				custom_effect_tooltip = activate_winelords_bop
				add_popularity = {
					ideology = opportunism
					popularity = 0.1
				}
				set_power_balance = {
					id = DOR_winelords_power_balance
					left_side = DOR_koldana_side
					right_side = DOR_vierling_side
				}
				if = { #reward PP
					limit = { has_country_flag = supporting_winelords }
					add_political_power = 100
				}
			}
			else = {
				custom_effect_tooltip = aldiana_bergholda_ascends
				custom_effect_tooltip = activate_great_merchants_bop
				add_popularity = {
					ideology = isolationism
					popularity = 0.1
				}
				set_power_balance = {
					id = DOR_great_merchants_power_balance
					left_side = DOR_burghers_side
					right_side = DOR_merchant_houses_side
				}
				if = { #reward PP
					limit = { has_country_flag = supporting_great_merchants }
					add_political_power = 100
				}
			}
		}
	}
}
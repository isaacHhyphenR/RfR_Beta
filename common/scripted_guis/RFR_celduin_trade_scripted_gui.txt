scripted_gui = {
	celduin_trade_GUI = {
		context_type = player_context
		window_name = "celduin_trade_ui_window"
		parent_window_token = trade_tab
		visible = { can_celduin_trade = yes }
		properties = {
			flag1 = {
				image = "[first_export_flag]"
				frame = 116:controller.ideology_index
			}
		}
		effects = {
			increase_export_1_click = {
				var:global.wine_exporter = {
					increase_riavod_trade_level = yes
				}
			}
			decrease_export_1_click = {
				var:global.wine_exporter = {
					decrease_riavod_trade_level = yes
				}
			}
		}
		triggers = {
			increase_export_1_click_enabled = {
				hidden_trigger = {
					#tooltip = cant_import_from_yourself
					NOT = { 116 = { is_controlled_by = ROOT } }
				}
				NOT = { has_war_with = 116.controller }
				NOT = { is_embargoed_by = 116.controller }
				custom_trigger_tooltip = {
					tooltip = first_export_wine_remaining_trigger
					116 = { controller = { check_variable = { wine_export_available > 0 } } }
				}
				num_of_civilian_factories_available_for_projects > 0
				#convoy cost
				custom_trigger_tooltip = {
					tooltip = has_enough_convoys_for_import
					check_variable = {
						var = num_equipment@convoy
						value = riavod_route_convoy_cost
						compare = greater_than_or_equals
					}
				}
			}
			decrease_export_1_click_enabled = {
				custom_trigger_tooltip = {
					tooltip = cant_import_from_yourself
					NOT = { check_variable = { global.wine_exporter = ROOT } }
				}
				custom_trigger_tooltip = {
					tooltip = is_importing_wine
					check_variable = { wine_imported > 0 }
				}
			}
		}
		ai_enabled = {
			always = yes
		}
        ai_weights = {
            increase_export_1_click = {
                ai_will_do = { #at least 2 available factories for the first route
					base = 1
					modifier = {
						num_of_civilian_factories_available_for_projects < 2
						factor = 0
					}
					modifier = { #at least 3 factories per subsequent routes
						set_temp_variable = { needed_factories = import_routes }
						multiply_temp_variable = { needed_factories = 3 }
						add_to_temp_variable = { needed_factories = 1 }
						num_of_civilian_factories_available_for_projects < var:needed_factories
						factor = 0
					}
				}
			}
            decrease_export_1_click = {
                ai_will_do = {
					base = 0
					modifier = {
						num_of_civilian_factories_available_for_projects < 1
					}
				}
			}
		}
	}
}
celduin_trade_category = {
	upgrade_market = {
		icon = GFX_decision_upgrade_market
		fire_only_once = no
		ai_will_do = { #ASAP
			factor = 10
		}
		days_mission_timeout = 100
		is_good = yes
		#days_remove = var:FROM.market_upgrade_time
		state_target = yes
		on_map_mode = map_only
		highlight_states = {
			highlight_state_targets = {
				state = FROM
			}
			highlight_color_while_active = 3
			highlight_color_before_active = 2
		}
		cancel_trigger = { ##upgrade gets canceled if conquered
			NOT = { controls_state = FROM }
		}
		allowed = { always = no }
		available = { always = no }
		cancel_effect = {
			FROM = { clr_state_flag = constructing_market }
			subtract_from_variable = { market_upgrading_cost = global.market_upgrade_cost }
		}
		timeout_effect = {
			FROM = {
				add_building_construction = {
					type = market
					level = 1
					instant_build = yes
				}
				custom_effect_tooltip = resets_prosperity
				set_variable = { prosperity = 0 }
			}
			FROM = { clr_state_flag = constructing_market }
			subtract_from_variable = { market_upgrading_cost = global.market_upgrade_cost }
		}
	}

	@luxury_cost = 999
	@luxury_cost_negative = -1000
	@wine_decision_days = 100
	
	auto_renew_luxury = {
		visible = { NOT = { has_country_flag = renew_luxury_decisions } }
		complete_effect = { set_country_flag = renew_luxury_decisions }
	}
	stop_auto_renew_luxury = {
		ai_will_do = { #ai should not auto renew
			factor = 1
		}
		visible = { has_country_flag = renew_luxury_decisions }
		complete_effect = { clr_country_flag = renew_luxury_decisions }
	}
	
	#############SPEND WINE
	wine_for_stability = {
		icon = GFX_decision_generic_stability
		ai_will_do = {
			factor = 1
			modifier = {
				has_stability < 0.75
				factor = 2
			}
			modifier = {
				has_stability < 0.5
				factor = 10
			}
			modifier = { #don't do if enough stability
				has_stability > 0.95
				factor = 0
			}
		}
		custom_cost_trigger = {
			has_equipment = { wine_equipment > @luxury_cost }
		}
		custom_cost_text = wine_decision_cost
		days_remove = @wine_decision_days
		modifier = {
			stability_weekly = 0.005
		}
		complete_effect = { #cost
			hidden_effect = {
				add_equipment_to_stockpile = { type = wine_equipment amount = @luxury_cost_negative }
			}
		}
		remove_effect = {
			hidden_effect = { #renews if possible
				if = { #try to renew
					limit = { has_country_flag = renew_luxury_decisions }
					if = { #renew if can afford
						limit = { has_equipment = { wine_equipment > @luxury_cost } }
						activate_decision = wine_for_stability
					}
					else = { #let the player know they can't renew
						news_event = rfr_news.79
					}
				}
			}
		}
	}
	
	wine_for_war_support = {
		icon = GFX_decision_generic_war_support
		ai_will_do = {
			factor = 1
			modifier = {
				has_war_support < 0.75
				OR = {
					has_war = yes
					has_government = melkorite
					has_government = conquest
				}
				factor = 2
			}
			modifier = {
				has_war_support < 0.5
				OR = {
					has_war = yes
					is_evil = yes
				}
				factor = 10
			}
			modifier = { #peaceful people don't really care
				has_war = no
				is_good = yes
				factor = 0
			}
			modifier = { #don't do if enough stability
				has_war_support > 0.95
				factor = 0
			}
		}
		custom_cost_trigger = {
			has_equipment = { wine_equipment > @luxury_cost }
		}
		custom_cost_text = wine_decision_cost
		days_remove = @wine_decision_days
		modifier = {
			war_support_weekly = 0.005
		}
		complete_effect = { #cost
			hidden_effect = {
				add_equipment_to_stockpile = { type = wine_equipment amount = @luxury_cost_negative }
			}
		}
		remove_effect = {
			hidden_effect = { #renews if possible
				if = { #try to renew
					limit = { has_country_flag = renew_luxury_decisions }
					if = { #renew if can afford
						limit = { has_equipment = { wine_equipment > @luxury_cost } }
						activate_decision = wine_for_war_support
					}
					else = { #let the player know they can't renew
						news_event = rfr_news.79
					}
				}
			}
		}
	}
	
	wine_for_consumer_goods = {
		icon = GFX_decision_generic_consumer_goods
		ai_will_do = {
			factor = 2
			modifier = { #don't do if not enough factories to likely make a difference
				num_of_factories < 15
				factor = 0
			}
		}
		custom_cost_trigger = {
			has_equipment = { wine_equipment > @luxury_cost }
		}
		custom_cost_text = wine_decision_cost
		days_remove = @wine_decision_days
		modifier = {
			consumer_goods_factor = -0.035
		}
		complete_effect = { #cost
			hidden_effect = {
				add_equipment_to_stockpile = { type = wine_equipment amount = @luxury_cost_negative }
			}
		}
		remove_effect = {
			hidden_effect = { #renews if possible
				if = { #try to renew
					limit = { has_country_flag = renew_luxury_decisions }
					if = { #renew if can afford
						limit = { has_equipment = { wine_equipment > @luxury_cost } }
						activate_decision = wine_for_consumer_goods
					}
					else = { #let the player know they can't renew
						news_event = rfr_news.79
					}
				}
			}
		}
	}
	
	wine_for_morale = {
		icon = GFX_decision_generic_military
		ai_will_do = {
			factor = 1
			modifier = { #more likely if outmatched
				enemies_strength_ratio > 1
				factor = 2
			}
			modifier = { #more likely if outmatched
				enemies_strength_ratio > 1.25
				factor = 2
			}
			modifier = { #more likely if losing ground
				any_owned_state = { NOT = { is_controlled_by = ROOT } }
				factor = 3
			}
			modifier = { #no reason if at peace
				has_war = no
				factor = 0
			}
		}
		custom_cost_trigger = {
			has_equipment = { wine_equipment > @luxury_cost }
		}
		custom_cost_text = wine_decision_cost
		days_remove = @wine_decision_days
		modifier = {
			army_morale_factor = 0.25
		}
		complete_effect = { #cost
			hidden_effect = {
				add_equipment_to_stockpile = { type = wine_equipment amount = @luxury_cost_negative }
			}
		}
		remove_effect = {
			hidden_effect = { #renews if possible
				if = { #try to renew
					limit = { has_country_flag = renew_luxury_decisions }
					if = { #renew if can afford
						limit = { has_equipment = { wine_equipment > @luxury_cost } }
						activate_decision = wine_for_morale
					}
					else = { #let the player know they can't renew
						news_event = rfr_news.79
					}
				}
			}
		}
	}
	
	wine_for_diplomacy = {
		icon = GFX_generic_befriend_decision
		ai_will_do = {
			factor = 0.25
			modifier = { #you don't need diplomacy!
				OR = {
					is_subject = yes
					AND = {
						has_war = yes
						is_in_faction = yes
					}
				}
				factor = 0
			}
		}
		custom_cost_trigger = {
			has_equipment = { wine_equipment > @luxury_cost }
		}
		custom_cost_text = wine_decision_cost
		days_remove = @wine_decision_days
		modifier = {
			improve_relations_maintain_cost_factor = -0.75
		}
		complete_effect = { #cost
			hidden_effect = {
				add_equipment_to_stockpile = { type = wine_equipment amount = @luxury_cost_negative }
			}
		}
		remove_effect = {
			hidden_effect = { #renews if possible
				if = { #try to renew
					limit = { has_country_flag = renew_luxury_decisions }
					if = { #renew if can afford
						limit = { has_equipment = { wine_equipment > @luxury_cost } }
						activate_decision = wine_for_diplomacy
					}
					else = { #let the player know they can't renew
						news_event = rfr_news.79
					}
				}
			}
		}
	}
	
	wine_for_ideology_drift = {
		icon = GFX_decision_eng_blackshirt_speech
		ai_will_do = {
			factor = 0.25
			modifier = { #you don't need diplomacy!
				OR = {
					is_subject = yes
					AND = {
						has_war = yes
						is_in_faction = yes
					}
				}
				factor = 0
			}
		}
		custom_cost_trigger = {
			has_equipment = { wine_equipment > @luxury_cost }
		}
		custom_cost_text = wine_decision_cost
		days_remove = @wine_decision_days
		modifier = {
			drift_defence_factor = -0.25
		}
		complete_effect = { #cost
			hidden_effect = {
				add_equipment_to_stockpile = { type = wine_equipment amount = @luxury_cost_negative }
			}
		}
		remove_effect = {
			hidden_effect = { #renews if possible
				if = { #try to renew
					limit = { has_country_flag = renew_luxury_decisions }
					if = { #renew if can afford
						limit = { has_equipment = { wine_equipment > @luxury_cost } }
						activate_decision = wine_for_ideology_drift
					}
					else = { #let the player know they can't renew
						news_event = rfr_news.79
					}
				}
			}
		}
	}
}


colonisation_category = {
	begin_colonisation = {
		icon = GFX_decision_settle_territory
		fire_only_once = no
		ai_will_do = {
			factor = 0
			modifier = {
				num_of_civilian_factories_available_for_projects > 3
				add = 1
			}
			modifier = {
				has_war = yes
				factor = 0
			}
			modifier = { #guide the colonisation path
				OR = {
					AND = { #east bight
						FROM = { state = 94 }
						ROOT = { OR = { tag = GLD tag = WOD } }
					}
					AND = { #upper mirvan
						FROM = { region = 18 }
						ROOT = { OR = { tag = MIR } }
					}
					AND = { #lower mirvan
						FROM = { region = 83 }
						ROOT = { OR = { tag = MIR } }
					}
				}
				factor = 2
			}
		}
		allowed = { NOT = { original_tag = FOR original_tag = WLD } } #wastelands can't colonise
		days_remove = 105
		state_target = yes
		targets = { 94 109 111 119 120 121 122  124 307 333 334 335 } #123 emyn muil
		highlight_states = {
			highlight_state_targets = {
				state = FROM
			}
			highlight_color_while_active = 3
			highlight_color_before_active = 2
		}
		visible = {
			NOT = { has_country_flag = already_colonising }
			has_tech = colony1
		}
			
		available = {
			NOT = { has_country_flag = already_colonising }
			num_of_civilian_factories_available_for_projects > 1
			has_manpower > 15000
		}
		target_trigger = {
			FROM = {
				is_owned_by = WLD
				any_neighbor_state = { is_core_of = ROOT }
			}
		}
		cancel_trigger = { ##upgrade gets canceled if conquered
			NOT = {
				FROM = {
					is_owned_by = WLD
					any_neighbor_state = { is_owned_by = ROOT }
				}
			}
		}
		cancel_effect = { clr_country_flag = already_colonising }
		modifier = {
			civilian_factory_use = 2
			weekly_manpower = -1000
		}
		complete_effect = {
			set_country_flag = already_colonising
		}
		remove_effect = {
			FROM = {
				transfer_state_to = ROOT
				set_variable = { base_population = state_population } #so it can reset if revolt
				add_manpower = 15000
			}
		}
	}
	annex_colony = {
		icon = GFX_decision_settle_territory
		fire_only_once = yes
		cost = 50
		ai_will_do = {
			factor = 10
		}
		allowed = { NOT = { original_tag = FOR original_tag = WLD } } #wastelands can't colonise
		state_target = yes
		targets = { 94 109 111 119 120 121 122 123 124 307 333 334 335 }
		highlight_states = {
			highlight_state_targets = {
				state = FROM
			}
			highlight_color_while_active = 3
			highlight_color_before_active = 2
		}
		available = {
			FROM = {
				infrastructure > 0
				state_population_k > 150
			}
		}
		target_trigger = {
			FROM = {
				is_owned_by = ROOT
				is_core_of  = WLD
			}
		}
		remove_effect = {
			FROM = {
				add_core_of = ROOT
				remove_core_of = WLD
				upgrade_state_category = yes
				remove_dynamic_modifier = { modifier = wilderness_state }
			}
			clr_country_flag = already_colonising
		}
	}
	
	DEBUG_colony_growth = {
		allowed = { is_debug = yes }
		days_remove = 100
		modifier = { colony_growth_monthly = 10000 }
	}
}
on_actions = {
	on_startup = {
		effect = { #setup Easterling khanates
			every_country = {
				limit = { OR = { has_idea = easterling_heritage_idea has_idea = steppe_heritage_idea } }
				load_steppe_warband = yes
			}
		}
		effect = { ##setup technology slowers, monster unlockers
			every_country = {
				if = {
					limit = { NOT = { has_tech = metallurgy1 } }
					add_ideas = hidden_metallurgy1
				}
				if = {
					limit = { NOT = { has_tech = metallurgy2 } }
					add_ideas = hidden_metallurgy2
				}
				if = {
					limit = { NOT = { has_tech = metallurgy3 } }
					add_ideas = hidden_metallurgy3
				}
				if = {
					limit = { NOT = { has_tech = metallurgy4 } }
					add_ideas = hidden_metallurgy4
				}
				if = {
					limit = { NOT = { has_tech = carpentry1 } }
					add_ideas = hidden_carpentry1
				}
				if = {
					limit = { NOT = { has_tech = carpentry2 } }
					add_ideas = hidden_carpentry2
				}
				if = {
					limit = { NOT = { has_tech = carpentry3 } }
					add_ideas = hidden_carpentry3
				}
				if = {
					limit = { NOT = { has_tech = carpentry4 } }
					add_ideas = hidden_carpentry4
				}
				if = {
					limit = { NOT = { has_tech = agriculture1 } }
					add_ideas = hidden_agriculture1
				}
				if = {
					limit = { NOT = { has_tech = agriculture2 } }
					add_ideas = hidden_agriculture2
				}
				if = {
					limit = { NOT = { has_tech = agriculture3 } }
					add_ideas = hidden_agriculture3
				}
				if = {
					limit = { NOT = { has_tech = agriculture4 } }
					add_ideas = hidden_agriculture4
				}
				###MONSTERS
				if = {
					limit = { has_idea_with_trait = hidden_troll_tamer_trait }
					set_technology = { hidden_troll_unlocker = 1 popup = no }
				}
				if = {
					limit = { has_idea_with_trait = hidden_mumakil_tamer_trait }
					set_technology = { hidden_mumak_unlocker = 1 popup = no }
				}
			}
		}
		effect = { #party ideology index
			every_possible_country = {
				set_ideology_index = yes
			}
		}
		effect = { #make day 1 wine
			FOR = {
				calculate_all_wine_production = yes
			}
			every_state = {
				limit = { market > 0 }
				daily_prosperity_gain = yes
			}
		}
	}
	on_daily_FOR = { #wine & precious metals gain, prosperity
		effect = {
			calculate_all_wine_production = yes
			#log = "GLOBAL P:[?global.prosperity_per_passthrough] I:[?global.prosperity_per_import] E:[?global.prosperity_per_export]"
			every_state = {
				limit = { market > 0 }
				daily_prosperity_gain = yes
			}
		}
	}
	on_monthly_FOR = { #colony growth
		effect = {
			WLD = {
				every_core_state = {
					limit = { NOT = { is_controlled_by = WLD } }
					set_temp_variable = { growth = controller:modifier@colony_growth_monthly }
					multiply_temp_variable = { growth = controller:modifier@colony_growth_monthly_factor }
					add_manpower = var:growth
					#cost scales by population
					set_variable = { integration_cost = state_population_k }
					divide_variable = { integration_cost = 3 }
					owner = {
						set_variable = { integration_cost = PREV.integration_cost }
					}
				}
			}
		}
	}
	on_ruling_party_change = { #party ideology index
		effect = {
			set_ideology_index = yes
		}
	}
	on_state_control_changed = {
		effect = { #exporters
			if = {
				limit = { FROM.FROM = { state = 116 } } #riavod
				set_variable = { global.wine_exporter = ROOT }
			}
			else_if = {
				limit = { FROM.FROM = { state = 101 } } #erebor
				set_variable = { global.gold_exporter = ROOT }
			}
		}
		effect = { #colony uprising
			if = {
				limit = {
					ROOT = { original_tag = WLD }
					FROM = { NOT = { original_tag = WLD } }
					FROM.FROM = { is_core_of = WLD NOT = { has_state_flag = ongoing_incursion } }
				}
				WLD = {
					##send a leader
					if = {
						limit = { has_character = WLD_wilderness1 }
						WLD_wilderness1 = { set_nationality = ROOT }
					}
					else_if = {
						limit = { has_character = WLD_wilderness2 }
						WLD_wilderness2 = { set_nationality = ROOT }
					}
					else_if = {
						limit = { has_character = WLD_wilderness3 }
						WLD_wilderness3 = { set_nationality = ROOT }
					}
					else_if = {
						limit = { has_character = WLD_wilderness4 }
						WLD_wilderness4 = { set_nationality = ROOT }
					}
					else_if = {
						limit = { has_character = WLD_wilderness5 }
						WLD_wilderness5 = { set_nationality = ROOT }
					}
				}
				ROOT = {
					set_cosmetic_tag = WLD_incursion
					add_equipment_to_stockpile = {
						type = infantry_equipment
						amount = 1000
					}
					add_manpower = 2000
					if = {
						limit = { has_character = WLD_wilderness1 }
						WLD_wilderness1 = { promote_character = clanship promote_character = feudalism promote_character = tribalism promote_character = autocracy promote_character = shadow_worship }
					}
					else_if = {
						limit = { has_character = WLD_wilderness2 }
						WLD_wilderness2 = { promote_character = clanship promote_character = feudalism promote_character = tribalism promote_character = autocracy promote_character = shadow_worship }
					}
					else_if = {
						limit = { has_character = WLD_wilderness3 }
						WLD_wilderness3 = { promote_character = clanship promote_character = feudalism promote_character = tribalism promote_character = autocracy promote_character = shadow_worship }
					}
					else_if = {
						limit = { has_character = WLD_wilderness4 }
						WLD_wilderness4 = { promote_character = clanship promote_character = feudalism promote_character = tribalism promote_character = autocracy promote_character = shadow_worship }
					}
					else_if = {
						limit = { has_character = WLD_wilderness5 }
						WLD_wilderness5 = { promote_character = clanship promote_character = feudalism promote_character = tribalism promote_character = autocracy promote_character = shadow_worship }
					}
				}
				FROM.FROM = {
					set_state_flag = ongoing_incursion
					save_event_target_as = incursion_state
				}
				FROM = { #inside to ensure event target carries over
					activate_targeted_decision = {
						target = FROM.FROM
						decision = uprising_in_colony
					}
					news_event = rfr_news.81
				}
			}
		}
		effect = { #DOR demoralised army
			if = {
				limit = {
					FROM = {
						original_tag = DOR
						has_any_level_demoralized_army = yes
						has_war_with = ROOT #don't demoralise if at peace
					}
					FROM.FROM = { NOT = { is_core_of = FROM } }
				}
				#calculate chance to reduce morale
				FROM.FROM = {
					if = {
						limit = { OR = { has_state_category = pastoral has_state_category = small_island } }
						set_temp_variable = { demoralize_chance = 5 }
					}
					else_if = {
						limit = { has_state_category = rural }
						set_temp_variable = { demoralize_chance = 10 }
					}
					else_if = {
						limit = { has_state_category = town }
						set_temp_variable = { demoralize_chance = 20 }
					}
					else_if = {
						limit = { has_state_category = large_town }
						set_temp_variable = { demoralize_chance = 25 }
					}
					else_if = {
						limit = { has_state_category = city }
						set_temp_variable = { demoralize_chance = 30 }
					}
					else_if = {
						limit = { has_state_category = large_city }
						set_temp_variable = { demoralize_chance = 40 }
					}
					else_if = {
						limit = { has_state_category = metropolis }
						set_temp_variable = { demoralize_chance = 50 }
					}
					else_if = {
						limit = { has_state_category = megalopolis }
						set_temp_variable = { demoralize_chance = 60 }
					}
					save_global_event_target_as = demoralize_state
					random = {
						chance = var:demoralize_chance
						FROM = {
							DOR_decrease_army_morale = yes
							news_event = rfr_news.95
						}
					}
				}
			}
			else_if = { #increase army morale
				limit = {
					ROOT = {
						original_tag = DOR
						has_any_level_demoralized_army = yes
						has_war_with = FROM #army doesn't get credit for peaceful aquisition
					}
					FROM.FROM = {
						NOT = { has_state_flag = remoralized_DOR }
						OR = {
							has_state_flag = ring_victory_point
							any_of_scopes = { #is major capital
								array = global.majors
								capital_scope = { state = PREV }
							}
						}
					}
				}
				FROM.FROM = {
					save_global_event_target_as = demoralize_state
					set_state_flag = remoralized_DOR #can only benefit each state once
					ROOT = {
						DOR_increase_army_morale = yes
						news_event = rfr_news.96
					}
				}
			}
		}
	}

	on_unit_leader_created = { # This uses the UNIT LEADER sub scope of a character, FROM == country
		effect = { #vierling loyalist
			character = {
				if = { 
					limit = {
						is_army_leader = yes
					}
					if = {
						limit = {#done here instead of the trait file to avoid some oddness with generating assignable traits under certain circumstances, makes it easier to control probabilities
							FROM = {
								has_completed_focus = DOR_cultivate_aggressive_officers
								has_character = DOR_vidumarh_vierling
							}
						}
						root = {
							random_list = {
								50 = { 
								}
								50 = { 
									add_unit_leader_trait = vierling_mil
									add_attack = 3
								}
							}
						}
					}
				}
			}
		}
	}
}
